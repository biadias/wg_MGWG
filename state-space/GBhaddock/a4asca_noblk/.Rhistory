library(FLa4a)
source('../../helper_code/a4a_funs.R')
#====================================================================
# read data
#====================================================================
setwd('../')
idxs <- readFLIndices('GBHADDOCK_survey.dat')
stk <- readFLStock('index.low', no.discards = TRUE)
stk <- setPlusGroup(stk, 9)
range(stk)[c('minfbar','maxfbar')] <- c(5,7)
setwd('a4asca')
#====================================================================
# replace 0 with half of the minimum
#====================================================================
catch.n(stk)[catch.n(stk)==0] <- min(catch.n(stk)[catch.n(stk)!=0])/2
idxs <- lapply(idxs, function(x){
index(x)[index(x)==0] <- min(index(x)[index(x)!=0])/2
x
})
#====================================================================
# Use only years with surveys
#====================================================================
my <- min(unlist(lapply(lapply(idxs, range), '[', 'minyear')))
stk <- window(stk, start=my)
names(idxs)
qmod <- list(~s(age, k=3, by=breakpts(year, 2008)), ~s(age, k=3, by=breakpts(year, 2008)), ~s(age, k=3))
fmod <- ~ te(age, year, k = c(4, 24)) + s(age, k = 3)
srmod <- ~geomean(CV=0.4)
fit <- sca(stk, idxs, fmodel=fmod, qmodel=qmod, srmodel=srmod)
fits <- simulate(fit, 500)
#====================================================================
# run retro and predictions
#====================================================================
stk.retro <- retro(stk, idxs, retro=7, k=c(age=4, year=20, age2=3), ftype="te", qmodel=qmod, srmodel=srmod)
fit.rm <- mohn(stk.retro)
fit.pi <- predIdxs(stk, idxs, qmodel=qmod, fmodel=fmod, srmodel=srmod)
fit.rm
stk.retro <- retro(stk, idxs, retro=7, k=c(age=4, year=24, age2=3), ftype="te", qmodel=qmod, srmodel=srmod)
fit.rm <- mohn(stk.retro)
fit.rm
plot(residuals(fit, stk, idxs))
BIC(fit)
fmod <- ~ te(age, year, k = c(4, 20)) + s(age, k = 3)
fit <- sca(stk, idxs, fmodel=fmod, qmodel=qmod, srmodel=srmod)
plot(residuals(fit, stk, idxs))
BIC(fit)
fmod <- ~ te(age, year, k = c(4, 20)) + s(age, k = 4)
fit <- sca(stk, idxs, fmodel=fmod, qmodel=qmod, srmodel=srmod)
BIC(fit)
plot(residuals(fit, stk, idxs))
fmod <- ~ te(age, year, k = c(4, 20)) + s(age, k = 5)
fit <- sca(stk, idxs, fmodel=fmod, qmodel=qmod, srmodel=srmod)
plot(residuals(fit, stk, idxs))
BIC(fit)
stk.retro <- retro(stk, idxs, retro=7, k=c(age=4, year=20, age2=5), ftype="te", qmodel=qmod, srmodel=srmod)
fit.rm <- mohn(stk.retro)
fit.rm
stk.retro <- retro(stk, idxs, retro=7, k=c(age=4, year=24, age2=5), ftype="te", qmodel=qmod, srmodel=srmod)
fit.rm <- mohn(stk.retro)
fit.rm
stk.retro <- retro(stk, idxs, retro=7, k=c(age=4, year=20, age2=5), ftype="te", qmodel=qmod, srmodel=srmod)
source('algorithm.R')
q()
source('algorithm.R')
source('algorithm.R')
q()
